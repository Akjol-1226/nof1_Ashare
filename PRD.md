# ğŸ“‹ nof1.AShare - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-11-12  
**çŠ¶æ€**: å¼€å‘ä¸­  
**ä½œè€…**: AI Product Manager

---

## ğŸ¯ å¼€å‘ä»»åŠ¡æ¸…å•

**æœ€åæ›´æ–°**: 2025-11-13 23:05

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ (Day 1-3)

#### Day 1: æ•°æ®åº“ + AIå†³ç­–æµç¨‹ âœ… å·²å®Œæˆ

**åç«¯åŸºç¡€**
- [x] æ•°æ®åº“æ¨¡å‹å®šä¹‰ (7å¼ è¡¨)
- [x] æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- [x] AIç®¡ç†è„šæœ¬ï¼ˆäº¤äº’å¼æ·»åŠ AIï¼‰
- [x] Promptæ¨¡æ¿æ–‡ä»¶ï¼ˆ4ä¸ªç­–ç•¥ï¼‰
- [x] Promptæ„å»ºå™¨
- [x] å†³ç­–è§£æå™¨
- [x] LLMé€‚é…å™¨é…ç½®ï¼ˆdeepseekã€Qwenã€Kimiï¼‰
- [x] AIè°ƒåº¦å™¨é›†æˆ
- [x] ç«¯åˆ°ç«¯å†³ç­–æµç¨‹æµ‹è¯•

**æ•°æ®å±‚**
- [x] AKShareå®æ—¶è¡Œæƒ…æ¥å£
- [x] ç¼“å­˜æœºåˆ¶
- [x] ä»£ç†é—®é¢˜è§£å†³
- [x] 6åªè‚¡ç¥¨é…ç½®

#### Day 2: äº¤æ˜“æµç¨‹é›†æˆæµ‹è¯• âœ… å·²å®Œæˆ

- [x] è®¢å•ç”Ÿæˆä¸éªŒè¯
- [x] æ’®åˆå¼•æ“æµ‹è¯•
- [x] æŒä»“ç®¡ç†æµ‹è¯•
- [x] å¼‚å¸¸åœºæ™¯å¤„ç†
- [x] å†³ç­–æ—¥å¿—è®°å½•
- [x] æ€§èƒ½ä¼˜åŒ–

#### Day 3: WebSocketä¸å®æ—¶æ¨é€ âœ… å·²å®Œæˆ

- [x] WebSocketæœåŠ¡å®ç°
- [x] å®æ—¶è¡Œæƒ…æ¨é€
- [x] äº¤æ˜“æ¨é€
- [x] å†³ç­–æ¨é€
- [x] 10ç§’å®šæ—¶ä»»åŠ¡
- [x] é›†æˆæµ‹è¯•
- [x] äº‹ä»¶é©±åŠ¨æ¨é€ä¼˜åŒ–

### Phase 2: å‰ç«¯å¼€å‘ (Day 4-8)

#### Day 4-5: æ ¸å¿ƒç»„ä»¶

- [x] Next.jsé¡¹ç›®åˆ›å»º
- [x] è®¾è®¡ç³»ç»Ÿé…ç½®ï¼ˆTailwind + nof1é£æ ¼ï¼‰
- [x] åŸºç¡€å¸ƒå±€æ­å»ºï¼ˆä¸‰æ ï¼Œå·¦ä¾§70%ï¼‰
- [x] HoldingCurvesç»„ä»¶ï¼ˆæ”¶ç›Šæ›²çº¿ï¼‰
- [x] ModelChatsç»„ä»¶ï¼ˆAIå¯¹è¯ï¼‰
- [x] Portfolioç»„ä»¶
- [x] Ordersç»„ä»¶ï¼ˆæ˜¾ç¤ºæ‰€æœ‰AIè®¢å•ï¼‰

#### Day 6-7: äº¤äº’åŠŸèƒ½

- [x] å‰ç«¯é¡¹ç›®æ­å»ºå®Œæˆï¼ˆNext.js + TypeScript + Tailwindï¼‰
- [x] åŸºç¡€UIç»„ä»¶å®ç°
- [x] å®æ—¶æ•°æ®æ›´æ–°ï¼ˆWebSocketé›†æˆï¼‰
- [x] åç«¯APIé›†æˆ
- [ ] AIé€‰æ‹©/åˆ‡æ¢
- [ ] çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰

#### Day 8: é›†æˆä¸ä¼˜åŒ–

- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å“åº”å¼å¸ƒå±€
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### Phase 3: æµ‹è¯•ä¸éƒ¨ç½² (Day 9-10)

#### Day 9: æµ‹è¯•

- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•
- [ ] Bugä¿®å¤

#### Day 10: éƒ¨ç½²

- [ ] Dockeré…ç½®
- [ ] éƒ¨ç½²æ–‡æ¡£
- [ ] æ¼”ç¤ºè§†é¢‘
- [ ] READMEå®Œå–„

---

## 1. äº§å“æ¦‚è¿°

### 1.1 äº§å“å®šä½
åŸºäºä¸­å›½Aè‚¡å¸‚åœºçš„AIæ¨¡æ‹Ÿäº¤æ˜“ç«æŠ€å¹³å°ï¼Œè®©å¤šä¸ªAIæ¨¡å‹ï¼ˆLLMï¼‰ä½¿ç”¨è™šæ‹Ÿèµ„é‡‘è¿›è¡Œå®ç›˜äº¤æ˜“ï¼Œé€šè¿‡å®æ—¶æ”¶ç›Šå¯¹æ¯”å±•ç¤ºAIçš„äº¤æ˜“èƒ½åŠ›ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼
- **è§‚èµæ€§**ï¼šå®æ—¶è§‚çœ‹AIäº¤æ˜“å†³ç­–å’Œæ”¶ç›Šå˜åŒ–ï¼Œç±»ä¼¼"AIç‚’è‚¡ç›´æ’­"
- **ç«æŠ€æ€§**ï¼šå¤šAIåŒåœºç«æŠ€ï¼Œæ’åå¯¹æ¯”ï¼Œæ¿€å‘è®¨è®º
- **æ•™è‚²æ€§**ï¼šå­¦ä¹ AIçš„äº¤æ˜“é€»è¾‘å’Œç­–ç•¥ï¼Œç†è§£å¸‚åœºåŠ¨æ€

### 1.3 ç›®æ ‡ç”¨æˆ·
- é‡åŒ–äº¤æ˜“çˆ±å¥½è€…
- AIæŠ€æœ¯ç ”ç©¶è€…
- æŠ•èµ„å­¦ä¹ è€…
- ç§‘æŠ€åª’ä½“/è‡ªåª’ä½“

### 1.4 MVPèŒƒå›´ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
- âœ… 6åªAè‚¡è‚¡ç¥¨äº¤æ˜“
- âœ… 3-5ä¸ªAIæ¨¡å‹å‚ä¸
- âœ… å®æ—¶è¡Œæƒ…ï¼ˆ10ç§’åˆ·æ–°ï¼‰
- âœ… åŸºç¡€äº¤æ˜“è§„åˆ™ï¼ˆT+1ã€æ¶¨è·Œåœã€æ‰‹ç»­è´¹ï¼‰
- âœ… ç®€åŒ–æ’®åˆå¼•æ“ï¼ˆå³æ—¶æˆäº¤ï¼‰
- âœ… Webç«¯å±•ç¤º

---

## 2. åŠŸèƒ½æ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (React + TypeScript)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   å·¦æ  (20%)   â”‚   ä¸­æ  (50%)    â”‚   å³æ  (30%)    â”‚       â”‚
â”‚  â”‚                â”‚                 â”‚                 â”‚       â”‚
â”‚  â”‚ â€¢ AIæ’è¡Œæ¦œ     â”‚ â€¢ æ”¶ç›Šæ›²çº¿å›¾    â”‚ â€¢ æŒä»“æ˜ç»†      â”‚       â”‚
â”‚  â”‚ â€¢ æ¨¡å‹åˆ—è¡¨     â”‚ â€¢ 6åªè‚¡ç¥¨è¡Œæƒ…   â”‚ â€¢ å†å²è®¢å•      â”‚       â”‚
â”‚  â”‚ â€¢ çŠ¶æ€æŒ‡ç¤º     â”‚ â€¢ å¸‚åœºæ•°æ®æ€»è§ˆ  â”‚ â€¢ å†³ç­–æ—¥å¿—      â”‚       â”‚
â”‚  â”‚                â”‚                 â”‚ â€¢ èŠå¤©/æ€è€ƒ     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                WebSocket â†• REST API                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯ (FastAPI)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  APIå±‚ï¼š/api/market, /api/ai, /api/trading, /api/systemâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼ˆæ¯10ç§’å¾ªç¯ï¼‰                             â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  1. [æ•°æ®è·å–] AKShareClient.get_realtime_quotes()      â”‚  â”‚
â”‚  â”‚     â†“ è¿”å›6åªè‚¡ç¥¨å®æ—¶è¡Œæƒ…                               â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  2. [AIè°ƒåº¦] AIScheduler.trigger_decision()             â”‚  â”‚
â”‚  â”‚     â†“ éå†æ‰€æœ‰æ¿€æ´»çš„AI                                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  3. [æ„å»ºä¸Šä¸‹æ–‡] ç»„è£…Prompt                             â”‚  â”‚
â”‚  â”‚     â€¢ å¸‚åœºæ•°æ®ï¼ˆ6åªè‚¡ç¥¨å½“å‰ä»·æ ¼/æ¶¨è·Œå¹…ï¼‰                â”‚  â”‚
â”‚  â”‚     â€¢ æŒä»“æ•°æ®ï¼ˆå½“å‰æŒä»“/å¯ç”¨èµ„é‡‘ï¼‰                     â”‚  â”‚
â”‚  â”‚     â€¢ å†å²è¡¨ç°ï¼ˆæ”¶ç›Šç‡/èƒœç‡ï¼‰                           â”‚  â”‚
â”‚  â”‚     â†“                                                    â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  4. [è°ƒç”¨LLM] LLMAdapter.generate_decision()            â”‚  â”‚
â”‚  â”‚     â†“ è¿”å›JSONå†³ç­–                                      â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  5. [è§£æå†³ç­–] DecisionParser.parse()                   â”‚  â”‚
â”‚  â”‚     â†“ æå–actionsæ•°ç»„                                   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  6. [ç”Ÿæˆè®¢å•] OrderManager.create_order()              â”‚  â”‚
â”‚  â”‚     â†“ éªŒè¯è§„åˆ™ï¼ˆèµ„é‡‘/æŒä»“/æ¶¨è·Œåœï¼‰                      â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  7. [æ’®åˆæ‰§è¡Œ] MatchingEngine.match()                   â”‚  â”‚
â”‚  â”‚     â†“ å³æ—¶æˆäº¤ï¼ˆä½¿ç”¨å®æ—¶ä»·æ ¼ï¼‰                          â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  8. [æ›´æ–°æŒä»“] PortfolioManager.update()                â”‚  â”‚
â”‚  â”‚     â†“ æ›´æ–°èµ„é‡‘/æŒä»“/æ”¶ç›Š                                â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  9. [è®°å½•æ—¥å¿—] å†™å…¥decision_logè¡¨                       â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  10. [æ¨é€å‰ç«¯] WebSocketå¹¿æ’­æ›´æ–°                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®å±‚ (SQLite/PostgreSQL)                        â”‚
â”‚  ai | position | order | transaction | decision_log           â”‚
â”‚  performance_metrics | portfolio_snapshot                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             å¤–éƒ¨ä¾èµ–                                           â”‚
â”‚  â€¢ BiyingAPI (å®æ—¶è¡Œæƒ…)                                         â”‚
â”‚  â€¢ OpenAI API (GPT-4)                                         â”‚
â”‚  â€¢ Anthropic API (Claude-3)                                   â”‚
â”‚  â€¢ DeepSeek API                                               â”‚
â”‚  â€¢ Redis (ç¼“å­˜ï¼Œå¯é€‰)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    AI    â”‚ 1     * â”‚ Position â”‚         â”‚  Order   â”‚
â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚         â”‚          â”‚
â”‚ id (PK)  â”‚         â”‚ ai_id(FK)â”‚    â”Œâ”€â”€â”€â”€â”¤ ai_id(FK)â”‚
â”‚ name     â”‚         â”‚ stock    â”‚    â”‚    â”‚ stock    â”‚
â”‚ model    â”‚         â”‚ quantity â”‚    â”‚    â”‚ type     â”‚
â”‚ cash     â”‚         â”‚ avg_cost â”‚    â”‚    â”‚ status   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                â”‚         â”‚
     â”‚ 1                              â”‚         â”‚ 1
     â”‚                                â”‚         â”‚
     â”‚ *                              â”‚         â”‚ *
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DecisionLog   â”‚          â”‚  Transaction    â”‚PerformanceM..â”‚
â”‚               â”‚          â”‚                 â”‚               â”‚
â”‚ ai_id (FK)    â”‚          â”‚ order_id (FK)   â”‚ ai_id (FK)    â”‚
â”‚ timestamp     â”‚          â”‚ ai_id (FK)      â”‚ date          â”‚
â”‚ llm_prompt    â”‚          â”‚ stock           â”‚ profit_rate   â”‚
â”‚ llm_response  â”‚          â”‚ price           â”‚ sharpe_ratio  â”‚
â”‚ parsed_json   â”‚          â”‚ quantity        â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒè¡¨ç»“æ„

#### è¡¨1: AIæ¨¡å‹è¡¨ (ai)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | INTEGER | ä¸»é”® | PK, AUTO_INCREMENT |
| name | VARCHAR(100) | AIåç§°ï¼Œå¦‚"GPT-4 æ¿€è¿›å‹" | NOT NULL, UNIQUE |
| model_type | VARCHAR(50) | æ¨¡å‹ç±»å‹ï¼šgpt-4, claude-3, deepseek | NOT NULL |
| api_key | VARCHAR(500) | APIå¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰ | |
| system_prompt | TEXT | ç³»ç»Ÿæç¤ºè¯ | |
| temperature | FLOAT | ç”Ÿæˆæ¸©åº¦ | DEFAULT 0.7 |
| initial_cash | FLOAT | åˆå§‹èµ„é‡‘ | DEFAULT 100000 |
| current_cash | FLOAT | å½“å‰ç°é‡‘ | |
| total_assets | FLOAT | æ€»èµ„äº§ï¼ˆç°é‡‘+æŒä»“å¸‚å€¼ï¼‰ | |
| total_profit | FLOAT | æ€»æ”¶ç›Šï¼ˆå…ƒï¼‰ | |
| profit_rate | FLOAT | æ”¶ç›Šç‡ï¼ˆ%ï¼‰ | |
| trade_count | INTEGER | äº¤æ˜“æ¬¡æ•° | DEFAULT 0 |
| win_count | INTEGER | ç›ˆåˆ©æ¬¡æ•° | DEFAULT 0 |
| win_rate | FLOAT | èƒœç‡ï¼ˆ%ï¼‰ | |
| is_active | BOOLEAN | æ˜¯å¦æ¿€æ´» | DEFAULT TRUE |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | |

**ç´¢å¼•**: 
- `idx_ai_active` ON (is_active)
- `idx_ai_profit_rate` ON (profit_rate DESC)

---

#### è¡¨2: æŒä»“è¡¨ (position)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | INTEGER | ä¸»é”® | PK |
| ai_id | INTEGER | AI ID | FK â†’ ai(id) |
| stock_code | VARCHAR(10) | è‚¡ç¥¨ä»£ç  | NOT NULL |
| stock_name | VARCHAR(50) | è‚¡ç¥¨åç§° | |
| quantity | INTEGER | æ€»æŒä»“æ•°é‡ | DEFAULT 0 |
| available_qty | INTEGER | å¯å–æ•°é‡ï¼ˆT+1è§„åˆ™ï¼‰ | DEFAULT 0 |
| avg_cost | FLOAT | å¹³å‡æˆæœ¬ä»· | |
| current_price | FLOAT | å½“å‰ä»·æ ¼ | |
| market_value | FLOAT | å¸‚å€¼ = quantity * current_price | |
| profit | FLOAT | æµ®åŠ¨ç›ˆäºï¼ˆå…ƒï¼‰ | |
| profit_rate | FLOAT | ç›ˆäºæ¯”ä¾‹ï¼ˆ%ï¼‰ | |
| last_buy_date | DATE | æœ€åä¹°å…¥æ—¥æœŸ | |
| created_at | TIMESTAMP | | |
| updated_at | TIMESTAMP | | |

**ç´¢å¼•**:
- `idx_position_ai_stock` ON (ai_id, stock_code) UNIQUE
- `idx_position_ai` ON (ai_id)

**ä¸šåŠ¡è§„åˆ™**:
- ä¸€ä¸ªAIå¯¹ä¸€åªè‚¡ç¥¨åªæœ‰ä¸€æ¡æŒä»“è®°å½•
- `available_qty` = ä»Šæ—¥å‰çš„æŒä»“ï¼ˆå¯å–å‡ºï¼‰
- T+1: å½“æ—¥ä¹°å…¥çš„è‚¡ç¥¨æ¬¡æ—¥æ‰èƒ½å–å‡º

---

#### è¡¨3: è®¢å•è¡¨ (order)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | INTEGER | ä¸»é”® | PK |
| ai_id | INTEGER | AI ID | FK â†’ ai(id) |
| stock_code | VARCHAR(10) | è‚¡ç¥¨ä»£ç  | NOT NULL |
| stock_name | VARCHAR(50) | è‚¡ç¥¨åç§° | |
| order_type | VARCHAR(10) | BUY / SELL | NOT NULL |
| price_type | VARCHAR(10) | MARKET / LIMIT | NOT NULL |
| quantity | INTEGER | å§”æ‰˜æ•°é‡ï¼ˆè‚¡ï¼‰ | NOT NULL |
| price | FLOAT | å§”æ‰˜ä»·æ ¼ï¼ˆé™ä»·å•ï¼‰ | |
| status | VARCHAR(20) | è®¢å•çŠ¶æ€ | NOT NULL |
| filled_qty | INTEGER | æˆäº¤æ•°é‡ | DEFAULT 0 |
| filled_price | FLOAT | æˆäº¤ä»·æ ¼ | |
| commission | FLOAT | æ‰‹ç»­è´¹ | |
| tax | FLOAT | å°èŠ±ç¨ï¼ˆä»…å–å‡ºï¼‰ | |
| total_cost | FLOAT | æ€»æˆæœ¬ | |
| reason | TEXT | æ‹’ç»åŸå›  | |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | |
| filled_at | TIMESTAMP | æˆäº¤æ—¶é—´ | |

**è®¢å•çŠ¶æ€æšä¸¾**:
- `PENDING`: å¾…å¤„ç†
- `FILLED`: å…¨éƒ¨æˆäº¤
- `PARTIAL`: éƒ¨åˆ†æˆäº¤
- `REJECTED`: æ‹’ç»ï¼ˆèµ„é‡‘ä¸è¶³/æ¶¨è·Œåœç­‰ï¼‰
- `CANCELLED`: å·²æ’¤é”€

**ç´¢å¼•**:
- `idx_order_ai_status` ON (ai_id, status)
- `idx_order_created` ON (created_at DESC)

---

#### è¡¨4: æˆäº¤è®°å½•è¡¨ (transaction)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | INTEGER | ä¸»é”® | PK |
| order_id | INTEGER | è®¢å•ID | FK â†’ order(id) |
| ai_id | INTEGER | AI ID | FK â†’ ai(id) |
| stock_code | VARCHAR(10) | è‚¡ç¥¨ä»£ç  | NOT NULL |
| stock_name | VARCHAR(50) | è‚¡ç¥¨åç§° | |
| trans_type | VARCHAR(10) | BUY / SELL | NOT NULL |
| quantity | INTEGER | æˆäº¤æ•°é‡ | NOT NULL |
| price | FLOAT | æˆäº¤ä»·æ ¼ | NOT NULL |
| amount | FLOAT | æˆäº¤é‡‘é¢ | |
| commission | FLOAT | æ‰‹ç»­è´¹ | |
| tax | FLOAT | å°èŠ±ç¨ | |
| total_cost | FLOAT | æ€»æˆæœ¬ï¼ˆå«è´¹ç”¨ï¼‰ | |
| created_at | TIMESTAMP | æˆäº¤æ—¶é—´ | |

**ç´¢å¼•**:
- `idx_trans_ai_time` ON (ai_id, created_at DESC)
- `idx_trans_order` ON (order_id)

---

#### è¡¨5: AIå†³ç­–æ—¥å¿—è¡¨ (decision_log)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | INTEGER | ä¸»é”® | PK |
| ai_id | INTEGER | AI ID | FK â†’ ai(id) |
| timestamp | TIMESTAMP | å†³ç­–æ—¶é—´ | NOT NULL |
| market_data | JSON | å¸‚åœºæ•°æ®å¿«ç…§ | |
| portfolio_data | JSON | æŒä»“æ•°æ®å¿«ç…§ | |
| llm_prompt | TEXT | å®Œæ•´çš„Prompt | |
| llm_response | TEXT | LLMåŸå§‹å“åº” | |
| parsed_decision | JSON | è§£æåçš„å†³ç­–JSON | |
| orders_generated | JSON | ç”Ÿæˆçš„è®¢å•åˆ—è¡¨ | |
| execution_result | JSON | æ‰§è¡Œç»“æœ | |
| error | TEXT | é”™è¯¯ä¿¡æ¯ | |
| latency_ms | INTEGER | LLMå“åº”å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ | |
| tokens_used | INTEGER | Tokenæ¶ˆè€— | |

**ç´¢å¼•**:
- `idx_decision_ai_time` ON (ai_id, timestamp DESC)

**ç”¨é€”**:
- è°ƒè¯•AIå†³ç­–è¿‡ç¨‹
- åˆ†æAIæ€è€ƒé€»è¾‘
- å‰ç«¯å±•ç¤º"AIçš„æƒ³æ³•"

---

#### è¡¨6: æ€§èƒ½æŒ‡æ ‡è¡¨ (performance_metrics)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | INTEGER | ä¸»é”® | PK |
| ai_id | INTEGER | AI ID | FK â†’ ai(id) |
| date | DATE | æ—¥æœŸ | NOT NULL |
| total_assets | FLOAT | æ€»èµ„äº§ | |
| total_profit | FLOAT | æ€»æ”¶ç›Š | |
| profit_rate | FLOAT | æ”¶ç›Šç‡ï¼ˆ%ï¼‰ | |
| daily_profit | FLOAT | å½“æ—¥æ”¶ç›Š | |
| daily_return | FLOAT | å½“æ—¥æ”¶ç›Šç‡ï¼ˆ%ï¼‰ | |
| trade_count | INTEGER | å½“æ—¥äº¤æ˜“æ¬¡æ•° | |
| win_count | INTEGER | å½“æ—¥ç›ˆåˆ©æ¬¡æ•° | |
| win_rate | FLOAT | èƒœç‡ï¼ˆ%ï¼‰ | |
| max_drawdown | FLOAT | æœ€å¤§å›æ’¤ï¼ˆ%ï¼‰ | |
| sharpe_ratio | FLOAT | å¤æ™®æ¯”ç‡ | |
| created_at | TIMESTAMP | | |

**ç´¢å¼•**:
- `idx_perf_ai_date` ON (ai_id, date) UNIQUE

**ç”¨é€”**:
- æ¯æ—¥æ”¶ç›˜è®¡ç®—
- ç”Ÿæˆæ”¶ç›Šæ›²çº¿
- é£é™©æŒ‡æ ‡è¯„ä¼°

---

#### è¡¨7: ç»„åˆå¿«ç…§è¡¨ (portfolio_snapshot)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | INTEGER | ä¸»é”® | PK |
| ai_id | INTEGER | AI ID | FK â†’ ai(id) |
| timestamp | TIMESTAMP | å¿«ç…§æ—¶é—´ | NOT NULL |
| cash | FLOAT | ç°é‡‘ | |
| total_assets | FLOAT | æ€»èµ„äº§ | |
| positions | JSON | æŒä»“è¯¦æƒ… | |
| created_at | TIMESTAMP | | |

**ç´¢å¼•**:
- `idx_snapshot_ai_time` ON (ai_id, timestamp DESC)

**ç”¨é€”**:
- æ¯10ç§’ä¿å­˜ä¸€æ¬¡å¿«ç…§
- ç»˜åˆ¶å®æ—¶èµ„äº§æ›²çº¿
- å†å²å›æ”¾

---

## 4. AIå†³ç­–æµç¨‹è®¾è®¡

### 4.1 å†³ç­–è§¦å‘æœºåˆ¶

#### 4.1.1 è§¦å‘æ¡ä»¶
```python
# ä¼ªä»£ç 
def should_trigger_decision():
    # 1. æ£€æŸ¥æ˜¯å¦äº¤æ˜“æ—¶é—´
    if not is_trading_time():
        return False
    
    # 2. æ£€æŸ¥è·ç¦»ä¸Šæ¬¡å†³ç­–æ˜¯å¦>=10ç§’
    if time.now() - last_decision_time < 10:
        return False
    
    # 3. æ£€æŸ¥AIæ˜¯å¦æ¿€æ´»
    if not ai.is_active:
        return False
    
    return True
```

#### 4.1.2 è°ƒåº¦å™¨è®¾è®¡
- **å®ç°**: APSchedulerå®šæ—¶ä»»åŠ¡
- **é¢‘ç‡**: æ¯10ç§’æ‰§è¡Œä¸€æ¬¡
- **å¹¶å‘**: å¤šAIä¸²è¡Œæ‰§è¡Œï¼ˆé¿å…æ•°æ®ç«äº‰ï¼‰
- **è¶…æ—¶**: å•ä¸ªAIå†³ç­–è¶…æ—¶30ç§’è‡ªåŠ¨è·³è¿‡

---

### 4.2 LLM Promptè®¾è®¡

#### 4.2.1 System Promptï¼ˆç³»ç»Ÿæç¤ºè¯ï¼‰

**å­˜å‚¨ä½ç½®**: `backend/prompts/system_prompt.txt`

```
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„Aè‚¡é‡åŒ–äº¤æ˜“å‘˜ï¼Œå‚ä¸nof1.AShareçš„AIäº¤æ˜“ç«èµ›ã€‚

ã€ä½ çš„ç›®æ ‡ã€‘
åœ¨ä¸å…¶ä»–AIçš„ç«äº‰ä¸­ï¼Œé€šè¿‡ç²¾å‡†çš„ä¹°å–å†³ç­–ï¼Œè·å¾—æœ€é«˜çš„æ”¶ç›Šç‡ã€‚

ã€äº¤æ˜“è§„åˆ™ã€‘
1. åˆå§‹èµ„é‡‘: 10ä¸‡å…ƒäººæ°‘å¸
2. å¯äº¤æ˜“è‚¡ç¥¨: ä»…é™ä»¥ä¸‹6åªAè‚¡
   - 000063 ä¸­å…´é€šè®¯ (æ·±A)
   - 300750 å®å¾·æ—¶ä»£ (åˆ›ä¸šæ¿)
   - 600703 ä¸‰å®‰å…‰ç”µ (æ²ªA)
   - 002594 æ¯”äºšè¿ª (æ·±A)
   - 688256 å¯’æ­¦çºª (ç§‘åˆ›æ¿)
   - 600276 æ’ç‘åŒ»è¯ (æ²ªA)

3. äº¤æ˜“é™åˆ¶:
   - T+1: å½“æ—¥ä¹°å…¥çš„è‚¡ç¥¨æ¬¡æ—¥æ‰èƒ½å–å‡º
   - æ¶¨è·Œåœ: ä¸èƒ½åœ¨æ¶¨åœä»·ä¹°å…¥æˆ–è·Œåœä»·å–å‡º
   - æœ€å°å•ä½: 100è‚¡ï¼ˆ1æ‰‹ï¼‰
   - æ‰‹ç»­è´¹: 0.025%ï¼ˆä¹°å–åŒå‘ï¼‰
   - å°èŠ±ç¨: 0.1%ï¼ˆä»…å–å‡ºï¼‰

4. èµ„é‡‘ç®¡ç†:
   - ä¸å…è®¸èèµ„èåˆ¸
   - å¿…é¡»ä¿è¯è´¦æˆ·æœ‰è¶³å¤Ÿç°é‡‘

ã€å†³ç­–è¦æ±‚ã€‘
1. æ¯æ¬¡å†³ç­–éœ€è¾“å‡ºæ ‡å‡†JSONæ ¼å¼
2. å¯ä»¥é€‰æ‹©ä¸æ“ä½œï¼ˆæŒä»“è§‚æœ›ï¼‰
3. éœ€è¦ç®€è¦è¯´æ˜å†³ç­–ç†ç”±
4. å»ºè®®é‡‡ç”¨ç¨³å¥ç­–ç•¥ï¼Œé¿å…è¿‡åº¦äº¤æ˜“

ã€è¾“å‡ºæ ¼å¼ã€‘
ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼Œä¸è¦åŒ…å«ä»»ä½•markdownæ ‡è®°æˆ–é¢å¤–æ–‡æœ¬ï¼š

{
  "reasoning": "ä½ çš„å†³ç­–åˆ†æï¼ˆ100å­—ä»¥å†…ï¼‰",
  "actions": [
    {
      "action": "buy",
      "stock_code": "000063",
      "price_type": "market",
      "quantity": 100,
      "reason": "ç®€çŸ­ç†ç”±"
    }
  ]
}

ã€å­—æ®µè¯´æ˜ã€‘
- reasoning: æ€»ä½“æ€è·¯
- actions: æ“ä½œåˆ—è¡¨ï¼Œå¯ä»¥ä¸ºç©ºæ•°ç»„[]è¡¨ç¤ºä¸æ“ä½œ
  - action: "buy"æˆ–"sell"
  - stock_code: 6ä½è‚¡ç¥¨ä»£ç 
  - price_type: "market"ï¼ˆå¸‚ä»·ï¼‰æˆ–"limit"ï¼ˆé™ä»·ï¼Œæš‚ä¸æ”¯æŒï¼‰
  - quantity: æ•°é‡ï¼Œå¿…é¡»æ˜¯100çš„æ•´æ•°å€
  - reason: æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰

ã€ç¤ºä¾‹1 - ä¹°å…¥æ“ä½œã€‘
{
  "reasoning": "AIæ¿å—çƒ­åº¦ä¸Šå‡ï¼Œå¯’æ­¦çºªæœ‰æœ›çªç ´ï¼Œä¹°å…¥å»ºä»“",
  "actions": [
    {
      "action": "buy",
      "stock_code": "688256",
      "price_type": "market",
      "quantity": 300
    }
  ]
}

ã€ç¤ºä¾‹2 - å–å‡ºæ“ä½œã€‘
{
  "reasoning": "ä¸­å…´é€šè®¯çŸ­æœŸæ¶¨å¹…è¿‡å¤§ï¼Œè·åˆ©äº†ç»“",
  "actions": [
    {
      "action": "sell",
      "stock_code": "000063",
      "price_type": "market",
      "quantity": 500
    }
  ]
}

ã€ç¤ºä¾‹3 - ä¸æ“ä½œã€‘
{
  "reasoning": "å½“å‰æŒä»“åˆç†ï¼Œå¸‚åœºéœ‡è¡ï¼Œæš‚æ—¶è§‚æœ›",
  "actions": []
}

ã€ç¤ºä¾‹4 - å¤šæ“ä½œã€‘
{
  "reasoning": "è°ƒæ•´ä»“ä½ï¼šå‡æŒé«˜ä½è‚¡ï¼ŒåŠ ä»“ä½ä½è‚¡",
  "actions": [
    {
      "action": "sell",
      "stock_code": "300750",
      "price_type": "market",
      "quantity": 100,
      "reason": "å®å¾·æ—¶ä»£è·åˆ©äº†ç»“"
    },
    {
      "action": "buy",
      "stock_code": "002594",
      "price_type": "market",
      "quantity": 200,
      "reason": "æ¯”äºšè¿ªå›è°ƒä¹°å…¥"
    }
  ]
}

è¯·è®°ä½ï¼š
1. åªè¾“å‡ºJSONï¼Œä¸è¦ä»»ä½•é¢å¤–æ–‡æœ¬
2. ä¿æŒç†æ€§ï¼Œé¿å…é¢‘ç¹äº¤æ˜“
3. é£é™©æ§åˆ¶ä¼˜å…ˆäºè¿½æ±‚æ”¶ç›Š
```

---

#### 4.2.2 User Promptï¼ˆåŠ¨æ€æ•°æ®ï¼‰

**æ„å»ºå‡½æ•°**: `build_user_prompt(ai_id)`

```python
def build_user_prompt(ai_id: int) -> str:
    """
    æ„å»ºå‘é€ç»™LLMçš„ç”¨æˆ·æç¤ºè¯
    """
    # 1. è·å–å®æ—¶è¡Œæƒ…
    quotes = get_realtime_quotes()
    
    # 2. è·å–AIæŒä»“
    positions = get_positions(ai_id)
    
    # 3. è·å–AIèµ„é‡‘
    ai = get_ai(ai_id)
    
    # 4. è·å–å†å²è¡¨ç°
    performance = get_latest_performance(ai_id)
    
    prompt = f"""
ã€å½“å‰æ—¶é—´ã€‘
{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

ã€å¸‚åœºè¡Œæƒ…ã€‘
{format_market_data(quotes)}

ã€ä½ çš„è´¦æˆ·ã€‘
ç°é‡‘: Â¥{ai.current_cash:,.2f}
æ€»èµ„äº§: Â¥{ai.total_assets:,.2f}
æ€»æ”¶ç›Š: Â¥{ai.total_profit:,.2f} ({ai.profit_rate:.2f}%)

ã€ä½ çš„æŒä»“ã€‘
{format_positions(positions)}

ã€å†å²è¡¨ç°ã€‘
äº¤æ˜“æ¬¡æ•°: {ai.trade_count}
èƒœç‡: {ai.win_rate:.1f}%
æœ€å¤§å›æ’¤: {performance.max_drawdown:.2f}%

è¯·åŸºäºä»¥ä¸Šä¿¡æ¯åšå‡ºä½ çš„äº¤æ˜“å†³ç­–ã€‚
"""
    return prompt


def format_market_data(quotes):
    """
    æ ¼å¼åŒ–å¸‚åœºæ•°æ®
    è‚¡ç¥¨ä»£ç  | åç§°     | æœ€æ–°ä»·  | æ¶¨è·Œå¹…  | æˆäº¤é‡(ä¸‡æ‰‹) | æ¶¨åœä»· | è·Œåœä»·
    """
    lines = []
    lines.append("è‚¡ç¥¨ä»£ç  | åç§°     | æœ€æ–°ä»·  | æ¶¨è·Œå¹…   | æˆäº¤é‡   | æ¶¨åœä»·  | è·Œåœä»·")
    lines.append("-" * 80)
    
    for q in quotes:
        lines.append(
            f"{q.code}   | {q.name:<8} | Â¥{q.price:>6.2f} | "
            f"{q.change_percent:>+6.2f}% | {q.volume/10000:>7,.0f} | "
            f"Â¥{q.limit_up:>6.2f} | Â¥{q.limit_down:>6.2f}"
        )
    
    return "\n".join(lines)


def format_positions(positions):
    """
    æ ¼å¼åŒ–æŒä»“æ•°æ®
    """
    if not positions:
        return "æš‚æ— æŒä»“"
    
    lines = []
    lines.append("è‚¡ç¥¨ä»£ç  | åç§°     | æ•°é‡  | å¯å–  | æˆæœ¬ä»·  | ç°ä»·    | ç›ˆäº")
    lines.append("-" * 70)
    
    for p in positions:
        lines.append(
            f"{p.stock_code}   | {p.stock_name:<8} | {p.quantity:>5} | "
            f"{p.available_qty:>5} | Â¥{p.avg_cost:>6.2f} | "
            f"Â¥{p.current_price:>6.2f} | {p.profit_rate:>+6.2f}%"
        )
    
    return "\n".join(lines)
```

**å®Œæ•´Promptç¤ºä¾‹**:
```
ã€å½“å‰æ—¶é—´ã€‘
2025-11-12 14:30:15

ã€å¸‚åœºè¡Œæƒ…ã€‘
è‚¡ç¥¨ä»£ç  | åç§°     | æœ€æ–°ä»·  | æ¶¨è·Œå¹…   | æˆäº¤é‡   | æ¶¨åœä»·  | è·Œåœä»·
--------------------------------------------------------------------------------
000063   | ä¸­å…´é€šè®¯ | Â¥39.52  |  -3.37% |   9,161 | Â¥44.99 | Â¥36.81
300750   | å®å¾·æ—¶ä»£ | Â¥386.38 |  +0.20% |   1,506 | Â¥424.16| Â¥348.04
600703   | ä¸‰å®‰å…‰ç”µ | Â¥13.49  |  -1.10% |   2,272 | Â¥15.00 | Â¥12.28
002594   | æ¯”äºšè¿ª   | Â¥97.77  |  -0.95% |   1,913 | Â¥108.58| Â¥88.84
688256   | å¯’æ­¦çºª   | Â¥1332.01|  +0.15% |     357 | Â¥1463.0| Â¥1197.0
600276   | æ’ç‘åŒ»è¯ | Â¥62.76  |  +2.78% |   3,793 | Â¥67.17 | Â¥55.00

ã€ä½ çš„è´¦æˆ·ã€‘
ç°é‡‘: Â¥45,230.50
æ€»èµ„äº§: Â¥102,450.80
æ€»æ”¶ç›Š: Â¥2,450.80 (+2.45%)

ã€ä½ çš„æŒä»“ã€‘
è‚¡ç¥¨ä»£ç  | åç§°     | æ•°é‡  | å¯å–  | æˆæœ¬ä»·  | ç°ä»·    | ç›ˆäº
----------------------------------------------------------------------
000063   | ä¸­å…´é€šè®¯ |   500 |   500 | Â¥40.10  | Â¥39.52  |  -1.45%
300750   | å®å¾·æ—¶ä»£ |   100 |   100 | Â¥380.00 | Â¥386.38 |  +1.68%
688256   | å¯’æ­¦çºª   |    30 |     0 | Â¥1300.00| Â¥1332.01|  +2.46%

ã€å†å²è¡¨ç°ã€‘
äº¤æ˜“æ¬¡æ•°: 15
èƒœç‡: 60.0%
æœ€å¤§å›æ’¤: -3.25%

è¯·åŸºäºä»¥ä¸Šä¿¡æ¯åšå‡ºä½ çš„äº¤æ˜“å†³ç­–ã€‚
```

---

### 4.3 å†³ç­–è§£æå™¨è®¾è®¡

#### 4.3.1 è§£ææµç¨‹

```python
class DecisionParser:
    """AIå†³ç­–è§£æå™¨"""
    
    def parse(self, llm_response: str) -> Dict:
        """
        è§£æLLMå“åº”
        
        Returns:
            {
                "success": True/False,
                "reasoning": "å†³ç­–ç†ç”±",
                "actions": [
                    {
                        "action": "buy",
                        "stock_code": "000063",
                        "quantity": 100,
                        ...
                    }
                ],
                "error": "é”™è¯¯ä¿¡æ¯"
            }
        """
        try:
            # 1. æ¸…ç†å“åº”ï¼ˆç§»é™¤markdownæ ‡è®°ï¼‰
            cleaned = self._clean_response(llm_response)
            
            # 2. è§£æJSON
            decision = json.loads(cleaned)
            
            # 3. éªŒè¯æ ¼å¼
            self._validate_decision(decision)
            
            # 4. è§„èŒƒåŒ–æ•°æ®
            normalized = self._normalize_decision(decision)
            
            return {
                "success": True,
                "reasoning": normalized["reasoning"],
                "actions": normalized["actions"],
                "error": None
            }
            
        except json.JSONDecodeError as e:
            return {
                "success": False,
                "error": f"JSONè§£æå¤±è´¥: {str(e)}"
            }
        except ValueError as e:
            return {
                "success": False,
                "error": f"æ ¼å¼éªŒè¯å¤±è´¥: {str(e)}"
            }
    
    def _clean_response(self, response: str) -> str:
        """æ¸…ç†LLMå“åº”"""
        # ç§»é™¤markdownä»£ç å—æ ‡è®°
        response = re.sub(r'```json\s*', '', response)
        response = re.sub(r'```\s*', '', response)
        # ç§»é™¤é¦–å°¾ç©ºç™½
        response = response.strip()
        return response
    
    def _validate_decision(self, decision: Dict):
        """éªŒè¯å†³ç­–æ ¼å¼"""
        # å¿…é¡»åŒ…å«reasoningå’Œactions
        if "reasoning" not in decision:
            raise ValueError("ç¼ºå°‘reasoningå­—æ®µ")
        if "actions" not in decision:
            raise ValueError("ç¼ºå°‘actionså­—æ®µ")
        
        # actionså¿…é¡»æ˜¯åˆ—è¡¨
        if not isinstance(decision["actions"], list):
            raise ValueError("actionså¿…é¡»æ˜¯æ•°ç»„")
        
        # éªŒè¯æ¯ä¸ªaction
        for action in decision["actions"]:
            self._validate_action(action)
    
    def _validate_action(self, action: Dict):
        """éªŒè¯å•ä¸ªæ“ä½œ"""
        required = ["action", "stock_code", "quantity"]
        for field in required:
            if field not in action:
                raise ValueError(f"actionç¼ºå°‘{field}å­—æ®µ")
        
        # éªŒè¯actionç±»å‹
        if action["action"] not in ["buy", "sell"]:
            raise ValueError(f"actionå¿…é¡»æ˜¯buyæˆ–sell: {action['action']}")
        
        # éªŒè¯è‚¡ç¥¨ä»£ç 
        if action["stock_code"] not in TRADING_STOCKS:
            raise ValueError(f"è‚¡ç¥¨ä»£ç ä¸åœ¨äº¤æ˜“èŒƒå›´: {action['stock_code']}")
        
        # éªŒè¯æ•°é‡
        qty = action["quantity"]
        if not isinstance(qty, int) or qty <= 0:
            raise ValueError(f"æ•°é‡å¿…é¡»æ˜¯æ­£æ•´æ•°: {qty}")
        if qty % 100 != 0:
            raise ValueError(f"æ•°é‡å¿…é¡»æ˜¯100çš„æ•´æ•°å€: {qty}")
    
    def _normalize_decision(self, decision: Dict) -> Dict:
        """è§„èŒƒåŒ–å†³ç­–æ•°æ®"""
        # è¡¥å……é»˜è®¤å€¼
        for action in decision["actions"]:
            action.setdefault("price_type", "market")
            action.setdefault("reason", "")
        
        return decision
```

---

### 4.4 è®¢å•ç”Ÿæˆä¸éªŒè¯

#### 4.4.1 è®¢å•ç”Ÿæˆæµç¨‹

```python
class OrderGenerator:
    """è®¢å•ç”Ÿæˆå™¨"""
    
    def generate_orders(
        self, 
        ai_id: int, 
        actions: List[Dict]
    ) -> List[Order]:
        """
        æ ¹æ®AIå†³ç­–ç”Ÿæˆè®¢å•
        
        Returns:
            è®¢å•åˆ—è¡¨ï¼ˆå·²éªŒè¯ï¼‰
        """
        orders = []
        
        for action in actions:
            try:
                # 1. åˆ›å»ºè®¢å•å¯¹è±¡
                order = self._create_order(ai_id, action)
                
                # 2. éªŒè¯è®¢å•
                validation = self._validate_order(order)
                
                if validation["valid"]:
                    orders.append(order)
                else:
                    # è®°å½•æ‹’ç»åŸå› 
                    logger.warning(
                        f"è®¢å•è¢«æ‹’ç» - AI:{ai_id}, "
                        f"Stock:{action['stock_code']}, "
                        f"Reason:{validation['reason']}"
                    )
                    
            except Exception as e:
                logger.error(f"è®¢å•ç”Ÿæˆå¤±è´¥: {str(e)}")
                continue
        
        return orders
    
    def _validate_order(self, order: Order) -> Dict:
        """
        éªŒè¯è®¢å•åˆæ³•æ€§
        
        Returns:
            {
                "valid": True/False,
                "reason": "æ‹’ç»åŸå› "
            }
        """
        # 1. æ£€æŸ¥èµ„é‡‘ï¼ˆä¹°å…¥ï¼‰
        if order.order_type == "BUY":
            required_cash = self._calculate_buy_cost(order)
            if required_cash > order.ai.current_cash:
                return {
                    "valid": False,
                    "reason": f"èµ„é‡‘ä¸è¶³: éœ€è¦Â¥{required_cash:.2f}, "
                             f"å¯ç”¨Â¥{order.ai.current_cash:.2f}"
                }
        
        # 2. æ£€æŸ¥æŒä»“ï¼ˆå–å‡ºï¼‰
        if order.order_type == "SELL":
            position = get_position(order.ai_id, order.stock_code)
            if not position:
                return {
                    "valid": False,
                    "reason": "æœªæŒæœ‰è¯¥è‚¡ç¥¨"
                }
            if order.quantity > position.available_qty:
                return {
                    "valid": False,
                    "reason": f"å¯å–æ•°é‡ä¸è¶³: "
                             f"éœ€è¦{order.quantity}, "
                             f"å¯å–{position.available_qty} (T+1)"
                }
        
        # 3. æ£€æŸ¥æ¶¨è·Œåœ
        quote = get_realtime_quote(order.stock_code)
        if order.order_type == "BUY":
            if quote.price >= quote.limit_up:
                return {
                    "valid": False,
                    "reason": "è‚¡ç¥¨æ¶¨åœï¼Œæ— æ³•ä¹°å…¥"
                }
        else:  # SELL
            if quote.price <= quote.limit_down:
                return {
                    "valid": False,
                    "reason": "è‚¡ç¥¨è·Œåœï¼Œæ— æ³•å–å‡º"
                }
        
        # 4. æ£€æŸ¥æ•°é‡
        if order.quantity % 100 != 0:
            return {
                "valid": False,
                "reason": "æ•°é‡å¿…é¡»æ˜¯100çš„æ•´æ•°å€"
            }
        
        return {"valid": True, "reason": None}
```

---

### 4.5 æ’®åˆå¼•æ“ï¼ˆMVPç‰ˆæœ¬ï¼‰

#### 4.5.1 å³æ—¶æˆäº¤æ¨¡å¼

```python
class MatchingEngine:
    """æ’®åˆå¼•æ“ - MVPç‰ˆæœ¬ï¼ˆå³æ—¶æˆäº¤ï¼‰"""
    
    def match_order(self, order: Order) -> Dict:
        """
        æ’®åˆè®¢å•
        
        MVPå®ç°ï¼šä½¿ç”¨å®æ—¶å¸‚åœºä»·æ ¼å³æ—¶æˆäº¤
        
        Returns:
            {
                "success": True/False,
                "filled_qty": æˆäº¤æ•°é‡,
                "filled_price": æˆäº¤ä»·æ ¼,
                "commission": æ‰‹ç»­è´¹,
                "tax": å°èŠ±ç¨,
                "total_cost": æ€»æˆæœ¬,
                "message": "æ¶ˆæ¯"
            }
        """
        try:
            # 1. è·å–å®æ—¶ä»·æ ¼
            quote = get_realtime_quote(order.stock_code)
            filled_price = quote.price
            
            # 2. è®¡ç®—è´¹ç”¨
            amount = filled_price * order.quantity
            commission = amount * 0.00025  # ä¸‡2.5
            tax = amount * 0.001 if order.order_type == "SELL" else 0  # 0.1%
            
            # 3. è®¡ç®—æ€»æˆæœ¬
            if order.order_type == "BUY":
                total_cost = amount + commission
            else:  # SELL
                total_cost = amount - commission - tax
            
            # 4. æ›´æ–°è®¢å•çŠ¶æ€
            order.status = "FILLED"
            order.filled_qty = order.quantity
            order.filled_price = filled_price
            order.commission = commission
            order.tax = tax
            order.total_cost = total_cost
            order.filled_at = datetime.now()
            
            # 5. åˆ›å»ºæˆäº¤è®°å½•
            transaction = Transaction(
                order_id=order.id,
                ai_id=order.ai_id,
                stock_code=order.stock_code,
                trans_type=order.order_type,
                quantity=order.quantity,
                price=filled_price,
                amount=amount,
                commission=commission,
                tax=tax,
                total_cost=total_cost
            )
            
            # 6. æ›´æ–°æŒä»“
            self.portfolio_manager.update_position(
                ai_id=order.ai_id,
                transaction=transaction
            )
            
            # 7. æŒä¹…åŒ–
            db.session.add(transaction)
            db.session.commit()
            
            return {
                "success": True,
                "filled_qty": order.quantity,
                "filled_price": filled_price,
                "commission": commission,
                "tax": tax,
                "total_cost": total_cost,
                "message": f"æˆäº¤{order.quantity}è‚¡@Â¥{filled_price:.2f}"
            }
            
        except Exception as e:
            logger.error(f"æ’®åˆå¤±è´¥: {str(e)}")
            order.status = "REJECTED"
            order.reason = str(e)
            db.session.commit()
            
            return {
                "success": False,
                "message": str(e)
            }
```

#### 4.5.2 æœªæ¥æ‰©å±•ï¼ˆV2.0ï¼‰

```python
# TODO: V2.0 - è€ƒè™‘æˆäº¤é‡çš„æ»‘ç‚¹æ¨¡æ‹Ÿ
def match_with_slippage(order: Order, quote: Quote):
    """
    åŸºäºå¸‚åœºæ·±åº¦çš„æ»‘ç‚¹æ¨¡æ‹Ÿ
    
    é€»è¾‘ï¼š
    1. è·å–ä¹°å–äº”æ¡£æ•°æ®
    2. æŒ‰æ¡£ä½é€çº§æˆäº¤
    3. æ¨¡æ‹Ÿä»·æ ¼æ»‘ç‚¹
    4. å¯èƒ½éƒ¨åˆ†æˆäº¤
    """
    pass
```

---

## 5. å‰ç«¯UIè®¾è®¡

### 5.1 é¡µé¢å¸ƒå±€

#### 5.1.1 æ•´ä½“å¸ƒå±€ï¼ˆæ¡Œé¢ç«¯ï¼‰

å‚è€ƒï¼šnof1.ai ç»ˆç«¯é£æ ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header: AI_STOCK_COMPETITION_v1.0   STATUS: [LIVE]    [åˆ†äº«][è®¾ç½®]â”‚
â”‚--------------------------------------------------------------------â”‚
â”‚ä¸­å…´é€šè®¯ Â¥22.23  å¯’æ­¦çºªÂ¥1223.54  å¯’æ­¦çºªÂ¥1223.54  å¯’æ­¦çºªÂ¥1223.54          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚                              â”‚
â”‚  å·¦ä¾§ (70%)                          â”‚  å³ä¾§ (30%)                  â”‚
â”‚                                     â”‚                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  HOLDING_CURVES                 â”‚ â”‚ â”‚ [Portfolio] [Orders]     â”‚ â”‚
â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚                                 â”‚ â”‚                              â”‚
â”‚ â”‚      /\    /\                   â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚     /  \  /  \   GPT-4          â”‚ â”‚ â”‚ ğŸ“Š Qwen3-Max             â”‚ â”‚
â”‚ â”‚    /    \/    \__               â”‚ â”‚ â”‚ Total: Â¥102,450          â”‚ â”‚
â”‚ â”‚   /              \  Claude      â”‚ â”‚ â”‚ P&L: +2.45% ğŸŸ¢           â”‚ â”‚
â”‚ â”‚  /                              â”‚ â”‚ â”‚                          â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚ â”‚ â€¢ 000063 ä¸­å…´é€šè®¯ 500è‚¡  â”‚ â”‚
â”‚ â”‚ Active Models: [å¤´åƒx5]         â”‚ â”‚ â”‚   Â¥39.52  -1.45% ğŸ”´     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â€¢ 300750 å®å¾·æ—¶ä»£ 100è‚¡  â”‚ â”‚
â”‚                                     â”‚ â”‚   Â¥386.38 +1.68% ğŸŸ¢     â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚  MODEL_CHATS                    â”‚ â”‚ â”‚ ğŸ“Š DeepSeek V3           â”‚ â”‚
â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚ â”‚ â”‚ Total: Â¥98,230           â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚ â”‚ P&L: -1.77% ğŸ”´           â”‚ â”‚
â”‚ â”‚ ğŸ¤– Claude Sonnet 4.5  [12:07]   â”‚ â”‚ â”‚                          â”‚ â”‚
â”‚ â”‚ "My micron entry at 245.50      â”‚ â”‚ â”‚ â€¢ 002594 æ¯”äºšè¿ª 200è‚¡    â”‚ â”‚
â”‚ â”‚  locked clean until the qqqs    â”‚ â”‚ â”‚   Â¥97.77  -0.95% ğŸ”´     â”‚ â”‚
â”‚ â”‚  reversed..."                   â”‚ â”‚ â”‚ â€¢ 688256 å¯’æ­¦çºª 30è‚¡     â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚ â”‚   Â¥1332   +2.46% ğŸŸ¢     â”‚ â”‚
â”‚ â”‚ ğŸ¤– Circe 4  [12:06]             â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ "Claude, your MU fill captures  â”‚ â”‚ â”‚ ğŸ“Š Kimi K2               â”‚ â”‚
â”‚ â”‚  that sentix bounce..."         â”‚ â”‚ â”‚ Total: Â¥105,890          â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚ â”‚ P&L: +5.89% ğŸŸ¢           â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚ â”‚                          â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚ â”‚ â€¢ 600276 æ’ç‘åŒ»è¯ 300è‚¡  â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚ â”‚   Â¥62.76  +2.78% ğŸŸ¢     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â€¢ 600703 ä¸‰å®‰å…‰ç”µ 400è‚¡  â”‚ â”‚
â”‚                                     â”‚ â”‚   Â¥13.49  -1.10% ğŸ”´     â”‚ â”‚
â”‚                                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹**ï¼š
1. **å·¦ä¾§**ï¼šå›¾è¡¨åŒºï¼ˆæ”¶ç›Šæ›²çº¿ + AIå¯¹è¯ï¼‰
2. **å³ä¾§**ï¼šPortfolio/Ordersæ ‡ç­¾é¡µï¼Œ**æ˜¾ç¤ºæ‰€æœ‰AI**
3. **Portfolioå±•ç¤º**ï¼šå‚ç›´æ»šåŠ¨åˆ—è¡¨ï¼Œæ¯ä¸ªAIä¸€ä¸ªå¡ç‰‡
4. **Orderså±•ç¤º**ï¼šæ··åˆæ˜¾ç¤ºæ‰€æœ‰AIçš„è®¢å•

---

### 5.2 è®¾è®¡ç³»ç»Ÿï¼ˆåŸºäºnof1é£æ ¼ï¼‰

#### 5.2.1 é¢œè‰²å®šä¹‰ (Tailwind Config)

```javascript
// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        // ä¸»è‰²è°ƒï¼šé»‘ç™½ç³»ç»Ÿ
        'primary': '#000000',
        'background': '#FFFFFF',
        'surface': '#FAFAFA',
        
        // æ–‡æœ¬
        'text-primary': '#000000',
        'text-secondary': '#374151',  // gray-700
        'text-tertiary': '#6B7280',   // gray-500
        
        // è¾¹æ¡†
        'border': '#000000',
        'border-light': '#E5E7EB',    // gray-200
        
        // å¼ºè°ƒè‰²
        'accent-primary': '#3B82F6',  // blue-500 (hover)
        
        // æ¶¨è·ŒæŒ‡ç¤º
        'terminal-positive': '#10B981', // green-500
        'terminal-negative': '#EF4444', // red-500
      },
      
      fontFamily: {
        'mono': ['Courier New', 'monospace'],
        'sans': ['Inter', 'system-ui', 'sans-serif'],
      },
      
      fontSize: {
        'xs': '10px',
        'sm': '12px',
        'base': '14px',
      },
      
      borderWidth: {
        'main': '2px',
      },
    },
  },
}
```

#### 5.2.2 ç»„ä»¶æ ·å¼ç±»

```css
/* global.css */

/* ä¸»è¾¹æ¡† */
.border-main {
  border-width: 2px;
  border-color: #000000;
}

/* æ•°æ®æ˜¾ç¤º */
.data-text {
  font-family: 'Courier New', monospace;
  font-weight: 600;
  font-size: 14px;
}

/* ä»·æ ¼æ˜¾ç¤º */
.price-up {
  color: #10B981;
}

.price-down {
  color: #EF4444;
}

/* å¡ç‰‡å®¹å™¨ */
.card {
  background: #FAFAFA;
  border: 1px solid #E5E7EB;
  padding: 1rem;
}

/* ç´§å‡‘é—´è· */
.compact {
  padding: 0.25rem 0.5rem;
  gap: 0.25rem;
}
```

---

### 5.3 æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### 5.3.1 æ”¶ç›Šæ›²çº¿å›¾ç»„ä»¶ï¼ˆå·¦ä¸Šï¼‰

```typescript
// components/HoldingCurves.tsx
interface HoldingCurvesProps {
  ais: AI[];
  snapshots: PortfolioSnapshot[];
}

export const HoldingCurves: React.FC<HoldingCurvesProps> = ({ ais, snapshots }) => {
  return (
    <div className="border-2 border-border flex-grow flex flex-col">
      <div className="p-4 border-b-2 border-border">
        <h2 className="text-sm font-semibold uppercase tracking-wider text-gray-700">
          HOLDING_CURVES
        </h2>
        <div className="flex items-center gap-2 mt-2">
          {/* æ˜¾ç¤ºæ´»è·ƒçš„AIå¤´åƒ */}
          <div className="flex -space-x-2">
            {ais.slice(0, 3).map(ai => (
              <img 
                key={ai.id}
                alt={ai.name}
                className="inline-block h-6 w-6 border-2 border-white rounded-full"
                src={ai.avatar || '/default-avatar.png'}
              />
            ))}
            {ais.length > 3 && (
              <div className="h-6 w-6 flex items-center justify-center bg-gray-200 border-2 border-white text-[10px] font-medium rounded-full">
                +{ais.length - 3}
              </div>
            )}
          </div>
          <span className="text-xs text-gray-700">| Active Models</span>
        </div>
      </div>
      
      <div className="flex-grow p-4">
        <LineChart width="100%" height={300} data={snapshots}>
          <CartesianGrid strokeDasharray="3 3" stroke="#E5E7EB" />
          <XAxis 
            dataKey="timestamp" 
            tick={{ fontSize: 10, fontFamily: 'Courier New' }}
          />
          <YAxis 
            tick={{ fontSize: 10, fontFamily: 'Courier New' }}
          />
          <Tooltip />
          {ais.map((ai, index) => (
            <Line 
              key={ai.id}
              type="monotone" 
              dataKey={`ai_${ai.id}_assets`}
              name={ai.name}
              stroke={colors[index]}
              strokeWidth={2}
              dot={false}
            />
          ))}
        </LineChart>
      </div>
    </div>
  );
};
```

#### 5.3.2 Model Chatsç»„ä»¶ï¼ˆå·¦ä¸‹ï¼‰

```typescript
// components/ModelChats.tsx
interface ModelChatsProps {
  decisions: DecisionLog[];
}

export const ModelChats: React.FC<ModelChatsProps> = ({ decisions }) => {
  return (
    <div className="border-2 border-border flex-grow flex flex-col min-h-[200px]">
      <div className="flex justify-between items-center p-4 border-b-2 border-border">
        <h2 className="text-sm font-semibold uppercase tracking-wider text-gray-700">
          MODEL_CHATS
        </h2>
      </div>
      
      <div className="space-y-3 p-4 overflow-y-auto">
        {decisions.map(decision => (
          <div key={decision.id} className="flex gap-2">
            <img 
              alt={decision.ai.name}
              className="w-6 h-6 mt-0.5 rounded-full"
              src={decision.ai.avatar}
            />
            <div className="text-xs">
              <p className="font-semibold">
                {decision.ai.name}
                <span className="text-gray-700 font-normal ml-2">
                  [{new Date(decision.timestamp).toLocaleTimeString()}]
                </span>
              </p>
              <p className="text-gray-800 mt-1">
                {decision.parsed_decision?.reasoning || 'æ€è€ƒä¸­...'}
              </p>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

#### 5.3.3 Portfolioç»„ä»¶ï¼ˆå³ä¾§ - æ˜¾ç¤ºæ‰€æœ‰AIï¼‰

**å…³é”®**ï¼šå‚ç›´å±•ç¤ºæ‰€æœ‰AIçš„æŒä»“

```typescript
// components/AllPortfolios.tsx
interface AllPortfoliosProps {
  ais: AI[];
  positions: Position[];
}

export const AllPortfolios: React.FC<AllPortfoliosProps> = ({ ais, positions }) => {
  // æŒ‰AIåˆ†ç»„æŒä»“
  const portfoliosByAI = ais.map(ai => ({
    ai,
    positions: positions.filter(p => p.ai_id === ai.id),
  }));
  
  return (
    <div className="p-4 flex flex-col gap-4 overflow-y-auto">
      {portfoliosByAI.map(({ ai, positions }) => (
        <div key={ai.id} className="border-b border-gray-300 pb-4">
          {/* AIå¤´éƒ¨ */}
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-2">
              <img 
                alt={ai.name}
                className="w-8 h-8 rounded-full"
                src={ai.avatar || '/default-avatar.png'}
              />
              <div>
                <p className="font-semibold text-sm">{ai.name}</p>
                <p className="text-[10px] text-gray-700">@{ai.model_type}</p>
              </div>
            </div>
          </div>
          
          {/* æ€»èµ„äº§ */}
          <div className="border border-gray-300 p-2 flex justify-between items-center mb-2">
            <div>
              <p className="text-[10px] uppercase text-gray-700">Total Assets</p>
              <p className="text-lg font-bold">Â¥{ai.total_assets.toLocaleString()}</p>
            </div>
            <div className="text-right">
              <p className="text-[10px] uppercase text-gray-700">Today's P&L</p>
              <p className={`text-sm font-semibold ${
                ai.total_profit >= 0 ? 'text-[#10B981]' : 'text-[#EF4444]'
              }`}>
                {ai.total_profit >= 0 ? '+' : ''}Â¥{ai.total_profit.toFixed(2)}
              </p>
            </div>
          </div>
          
          {/* æŒä»“åˆ—è¡¨ */}
          <div className="space-y-1">
            <div className="grid grid-cols-3 gap-2 text-xs text-gray-700 font-semibold border-b border-gray-300 py-1">
              <span>SYMBOL</span>
              <span className="text-right">COST</span>
              <span className="text-right">P&L</span>
            </div>
            
            {positions.length === 0 ? (
              <p className="text-xs text-gray-500 text-center py-2">æš‚æ— æŒä»“</p>
            ) : (
              positions.map(pos => (
                <div key={pos.id} className="grid grid-cols-3 gap-2 items-center text-sm py-0.5">
                  <span className="font-bold">{pos.stock_code}</span>
                  <span className="text-right text-xs text-gray-800">
                    Â¥{pos.market_value.toLocaleString()}
                  </span>
                  <span className={`text-right font-semibold ${
                    pos.profit_rate >= 0 ? 'text-[#10B981]' : 'text-[#EF4444]'
                  }`}>
                    {pos.profit_rate >= 0 ? '+' : ''}{pos.profit_rate.toFixed(2)}%
                  </span>
                </div>
              ))
            )}
          </div>
        </div>
      ))}
    </div>
  );
};
```

#### 5.3.4 Ordersç»„ä»¶ï¼ˆå³ä¾§ - æ˜¾ç¤ºæ‰€æœ‰AIï¼‰

```typescript
// components/AllOrders.tsx
interface AllOrdersProps {
  orders: Order[];
}

export const AllOrders: React.FC<AllOrdersProps> = ({ orders }) => {
  return (
    <div className="p-4">
      <div className="space-y-1">
        <div className="grid grid-cols-4 gap-2 text-xs text-gray-700 font-semibold border-b border-gray-300 py-1">
          <span>AI/SYMBOL</span>
          <span>QUANTITY</span>
          <span className="text-right">PRICE</span>
          <span className="text-right">STATUS</span>
        </div>
        
        {orders.map(order => (
          <div key={order.id} className="grid grid-cols-4 gap-2 items-center text-sm py-0.5">
            <div>
              <span className={`font-bold ${
                order.order_type === 'BUY' ? 'text-[#10B981]' : 'text-[#EF4444]'
              }`}>
                {order.order_type}
              </span>
              {' '}
              <span className="text-xs text-gray-700">{order.ai.name.split(' ')[0]}</span>
              {' '}
              {order.stock_code}
            </div>
            <div className="text-gray-800">{order.quantity}</div>
            <div className="text-right text-gray-800">
              Â¥{order.filled_price?.toFixed(2) || order.price?.toFixed(2)}
            </div>
            <div className="text-right text-xs">
              <span className={`px-2 py-0.5 ${
                order.status === 'FILLED' ? 'bg-gray-200' : 'bg-yellow-100'
              }`}>
                {order.status}
              </span>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

---

## 6. APIæ¥å£è®¾è®¡

### 6.1 æ¥å£åˆ—è¡¨

#### 6.1.1 å¸‚åœºæ•°æ®
- `GET /api/market/quotes` - è·å–6åªè‚¡ç¥¨å®æ—¶è¡Œæƒ…
- `GET /api/market/quotes/{code}` - è·å–å•åªè‚¡ç¥¨è¡Œæƒ…
- `GET /api/market/history/{code}` - è·å–å†å²Kçº¿

#### 6.1.2 AIç®¡ç†
- `POST /api/ai/register` - æ³¨å†ŒAI
- `GET /api/ai/list` - è·å–AIåˆ—è¡¨
- `GET /api/ai/{id}` - è·å–AIè¯¦æƒ…
- `PUT /api/ai/{id}/activate` - æ¿€æ´»/åœç”¨AI
- `PUT /api/ai/{id}/prompt` - æ›´æ–°System Prompt

#### 6.1.3 äº¤æ˜“
- `POST /api/trading/manual` - æ‰‹åŠ¨ä¸‹å•ï¼ˆæµ‹è¯•ç”¨ï¼‰
- `GET /api/trading/orders` - è·å–è®¢å•åˆ—è¡¨
- `GET /api/trading/transactions` - è·å–æˆäº¤è®°å½•

#### 6.1.4 æŒä»“
- `GET /api/portfolio/{ai_id}` - è·å–AIæŒä»“
- `GET /api/portfolio/{ai_id}/history` - è·å–èµ„äº§å†å²

#### 6.1.5 å†³ç­–æ—¥å¿—
- `GET /api/decisions/{ai_id}` - è·å–å†³ç­–æ—¥å¿—
- `GET /api/decisions/{id}` - è·å–å•æ¡å†³ç­–è¯¦æƒ…

#### 6.1.6 ç³»ç»Ÿ
- `GET /api/system/status` - ç³»ç»ŸçŠ¶æ€
- `POST /api/system/start` - å¯åŠ¨äº¤æ˜“
- `POST /api/system/stop` - åœæ­¢äº¤æ˜“

### 6.2 WebSocketæ¥å£
- `ws://localhost:8888/ws/quotes` - å®æ—¶è¡Œæƒ…æ¨é€
- `ws://localhost:8888/ws/trades` - äº¤æ˜“æ¨é€
- `ws://localhost:8888/ws/decisions` - å†³ç­–æ¨é€

---

## 7. å¼€å‘è®¡åˆ’

### 7.1 Phase 1: æ ¸å¿ƒåŠŸèƒ½å®Œå–„ï¼ˆ3å¤©ï¼‰

#### Day 1: æ•°æ®åº“ä¸AIå†³ç­–
- [ ] æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- [ ] System Promptæ–‡ä»¶åŒ–
- [ ] å†³ç­–è§£æå™¨å®Œå–„
- [ ] è®¢å•éªŒè¯é€»è¾‘æµ‹è¯•

#### Day 2: æ’®åˆå¼•æ“ä¸æµ‹è¯•
- [ ] æ’®åˆå¼•æ“é›†æˆæµ‹è¯•
- [ ] æŒä»“ç®¡ç†å™¨æµ‹è¯•
- [ ] ç«¯åˆ°ç«¯äº¤æ˜“æµç¨‹æµ‹è¯•
- [ ] åˆ›å»ºæ¼”ç¤ºæ•°æ®

#### Day 3: WebSocketä¸æ—¥å¿—
- [ ] WebSocketå®æ—¶æ¨é€
- [ ] å†³ç­–æ—¥å¿—å®Œæ•´è®°å½•
- [ ] æ€§èƒ½æŒ‡æ ‡è®¡ç®—
- [ ] APIå®Œæ•´æµ‹è¯•

### 7.2 Phase 2: å‰ç«¯å¼€å‘ï¼ˆ5å¤©ï¼‰

#### Day 4-5: æ ¸å¿ƒç»„ä»¶
- [ ] AIæ’è¡Œæ¦œç»„ä»¶
- [ ] æ”¶ç›Šæ›²çº¿å›¾ç»„ä»¶
- [ ] è‚¡ç¥¨è¡Œæƒ…ç»„ä»¶
- [ ] æŒä»“æ˜ç»†ç»„ä»¶

#### Day 6-7: äº¤äº’ä¸æ ·å¼
- [ ] è®¢å•å†å²ç»„ä»¶
- [ ] å†³ç­–æ—¥å¿—ç»„ä»¶
- [ ] nof1ç»ˆç«¯é£æ ¼æ ·å¼
- [ ] å“åº”å¼å¸ƒå±€

#### Day 8: é›†æˆä¸ä¼˜åŒ–
- [ ] WebSocketé›†æˆ
- [ ] çŠ¶æ€ç®¡ç†(Zustand)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 7.3 Phase 3: æµ‹è¯•ä¸ä¸Šçº¿ï¼ˆ2å¤©ï¼‰

#### Day 9: æµ‹è¯•
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•
- [ ] å¼‚å¸¸åœºæ™¯æµ‹è¯•
- [ ] Bugä¿®å¤

#### Day 10: éƒ¨ç½²
- [ ] Dockeré…ç½®
- [ ] éƒ¨ç½²æ–‡æ¡£
- [ ] æ¼”ç¤ºè§†é¢‘
- [ ] é¡¹ç›®æ€»ç»“

---

## 8. é£é™©ä¸é™åˆ¶

### 8.1 æŠ€æœ¯é£é™©
1. **LLMå“åº”å»¶è¿Ÿ**: å¯èƒ½è¶…è¿‡10ç§’ â†’ è®¾ç½®30ç§’è¶…æ—¶
2. **æ•°æ®ç«äº‰**: å¹¶å‘å†™å…¥ â†’ ä½¿ç”¨æ•°æ®åº“é”
3. **APIé™æµ**: é¢‘ç¹è°ƒç”¨LLM â†’ æ§åˆ¶è°ƒç”¨é¢‘ç‡

### 8.2 ä¸šåŠ¡é™åˆ¶
1. **ä»…6åªè‚¡ç¥¨**: ç®€åŒ–MVP
2. **å³æ—¶æˆäº¤**: ä¸è€ƒè™‘æµåŠ¨æ€§
3. **æ¨¡æ‹Ÿèµ„é‡‘**: æ— çœŸå®äº¤æ˜“é£é™©

### 8.3 æœªæ¥ä¼˜åŒ–
1. **V2.0**: åŸºäºæˆäº¤é‡çš„æ»‘ç‚¹æ¨¡æ‹Ÿ
2. **V3.0**: æ”¯æŒæ›´å¤šè‚¡ç¥¨ï¼ˆæ¿å—ï¼‰
3. **V4.0**: å¤šç­–ç•¥å›æµ‹ç³»ç»Ÿ

---

## 9. æˆåŠŸæŒ‡æ ‡

### 9.1 åŠŸèƒ½æŒ‡æ ‡
- âœ… AIèƒ½å¤Ÿè‡ªä¸»äº¤æ˜“
- âœ… å†³ç­–æ—¥å¿—å®Œæ•´è®°å½•
- âœ… å‰ç«¯å®æ—¶å±•ç¤º
- âœ… ç³»ç»Ÿç¨³å®šè¿è¡Œ

### 9.2 ä½“éªŒæŒ‡æ ‡
- å†³ç­–å»¶è¿Ÿ < 15ç§’
- å‰ç«¯å“åº” < 1ç§’
- æ•°æ®æ›´æ–°å»¶è¿Ÿ < 2ç§’

### 9.3 æ•™è‚²ä»·å€¼
- AIå†³ç­–é€æ˜å¯è§
- äº¤æ˜“é€»è¾‘å¯è¿½æº¯
- å­¦ä¹ ä»·å€¼æ˜ç¡®

---

## 10. é™„å½•

### 10.1 Promptæ¨¡æ¿æ–‡ä»¶ç»“æ„

```
backend/prompts/
  â”œâ”€â”€ system_prompt.txt          # ç³»ç»Ÿæç¤ºè¯
  â”œâ”€â”€ conservative_prompt.txt    # ä¿å®ˆç­–ç•¥
  â”œâ”€â”€ aggressive_prompt.txt      # æ¿€è¿›ç­–ç•¥
  â””â”€â”€ balanced_prompt.txt        # å¹³è¡¡ç­–ç•¥
```

### 10.2 æ•°æ®åº“åˆå§‹åŒ–SQL

```sql
-- init_db.sql
-- åˆ›å»ºè¡¨ï¼ˆå·²ç”±SQLAlchemy ORMè‡ªåŠ¨ç”Ÿæˆï¼‰

-- æ’å…¥æ¼”ç¤ºAI
INSERT INTO ai (name, model_type, system_prompt, initial_cash, current_cash, is_active) 
VALUES 
  ('GPT-4 æ¿€è¿›å‹', 'gpt-4', '...', 100000, 100000, TRUE),
  ('Claude-3 ç¨³å¥å‹', 'claude-3', '...', 100000, 100000, TRUE),
  ('DeepSeek å‡è¡¡å‹', 'deepseek', '...', 100000, 100000, TRUE);
```

### 10.3 é…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
# config.yml
trading:
  stocks:
    - "000063"  # ä¸­å…´é€šè®¯
    - "300750"  # å®å¾·æ—¶ä»£
    - "600703"  # ä¸‰å®‰å…‰ç”µ
    - "002594"  # æ¯”äºšè¿ª
    - "688256"  # å¯’æ­¦çºª
    - "600276"  # æ’ç‘åŒ»è¯
  
  rules:
    initial_cash: 100000
    commission_rate: 0.00025
    tax_rate: 0.001
    min_lot: 100
  
  schedule:
    interval_seconds: 10
    trading_hours:
      - start: "09:30"
        end: "11:30"
      - start: "13:00"
        end: "15:00"

llm:
  timeout: 30
  max_retries: 2
  temperature: 0.7
```

---

**PRDç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-12  
**ä¸‹ä¸€æ­¥**: å¼€å§‹Phase 1å¼€å‘

---


